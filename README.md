# 飲食店予約サービス Rese

## アプリケーション名  
**Rese(リーズ)**

### ①新規会員登録ページ  
正しく情報を入力し「会員登録」ボタンを押下すると、②のサンクスページに遷移します。  
バリデーションルールは以下の通りです。(名前、メールアドレス、パスワードはいずれも必須項目)  
+ 名前：191文字以内、文字列型。  
+ メールアドレス：191文字以内、文字列型（メールアドレス形式）。既に登録されているメールアドレスとの重複不可。  
+ パスワード：8文字以上191文字以内、文字列型。パスワードと確認用パスワードは同一のものが入力されていること。
+ ![一般ユーザー新規作成](https://github.com/palhina/Rese/assets/129643430/98751520-ea55-4d18-8926-9a610b91196d)
   
### ②サンクスページ  
①の画面で正しく会員登録が完了すると、この画面が表示されます。  
「ログインする」ボタン押下で③のログインページへ遷移します。  
※画像追加！！  
  
### ③ログインページ  
②で「ログインする」を押すか、あるいはハンバーガーメニュー「Login」押下で表示されます。
登録した情報を正しく入力し「ログイン」ボタンを押下すると、⑤の飲食店一覧画面が表示されます。  
バリデーションルールは新規会員登録時と同じです。  
![一般ユーザーログイン](https://github.com/palhina/Rese/assets/129643430/25276e7c-9f93-4e19-b6f6-137072b378db)  
  
### ④ハンバーガーメニュー(未ログイン)  
ログインしていない状態で画面左上ハンバーガーメニューを押下すると、以下の画面が表示されます。 
「HOME」押下で⑤の飲食店一覧画面、「Registration」押下で①の新規会員登録画面、「Login」押下で③のログインページ、「Login(二段階認証機能使用)」押下でログインページ(二段階認証機能)、「店舗代表の方」押下で店舗代表者ログインページ、「管理メニュー」押下で管理者ログインページへそれぞれ遷移します。  
![ハンバーガーメニュー(未ログイン)](https://github.com/palhina/Rese/assets/129643430/34a21a10-e531-49d4-9522-22d2198f4048)  

### ⑤飲食店一覧ページ  
ログインしている場合は、店舗がお気に入り登録されている際にハートマークが赤く表示されます。  
赤いハートマークを押下すると灰色表示に変化し、お気に入りから削除されます。また、灰色のハートマーク押下で赤表示に変化し、お気に入り登録されます。    
未ログイン時はハートマークはすべて灰色表示となり、押下すると③のログインページへ遷移します。  
右上の検索バーに地域、ジャンル、飲食店名を入力し「Search」ボタン押下すると検索が可能です。  
「詳しく見る」ボタン押下で⑥の飲食店詳細ページへ遷移します。  
![HOME](https://github.com/palhina/Rese/assets/129643430/575aa906-b7e3-4e4d-bf59-cc52bf47f584)  

### 二段階認証  
Fortifyを使用しています。  
新規会員登録または初回ログイン時に表示され、同時に登録したメールアドレスに認証メールが送信されます。    
「メール再送信」ボタン押下で、認証メールが再度送信されます。  
![2段階認証](https://github.com/palhina/Atte/assets/129643430/3658d222-a353-447a-b58b-9fd997dd82f2)
### メール画面  
二段階認証時、登録されたメールアドレスに送信されるメール画面です。  
「メールアドレスの確認」ボタン押下で二段階認証は完了し、打刻ページに遷移しナビゲーションメニューが表示されます。  
![メール画面(2段階認証用)](https://github.com/palhina/Atte/assets/129643430/521c4bc9-f63f-4dc9-9659-2d2bed05f41c)  
### 打刻ページ(勤務開始)  
勤務開始前または最後に押したボタンが「勤務終了」であった場合、ログイン成功直後やナビゲーションメニュー「ホーム」押下で表示されるページです。  
 打刻ボタンは「勤務開始」のみ押すことが可能です。  
 「勤務開始」ボタン押下で打刻ページ(勤務終了、休憩開始)に遷移します。  
![打刻ページ(勤務開始)](https://github.com/palhina/Atte/assets/129643430/e14a609f-82ba-4ac5-9702-9e183b228e24)
### 打刻ページ(勤務終了、休憩開始)    
最後に押したボタンが「勤務開始」、または「休憩終了」だった場合、ログイン成功直後やナビゲーションメニュー「ホーム」押下で表示されるページです。  
打刻ボタンは「勤務終了」「休憩開始」のみ押すことが可能です。  
「勤務終了」ボタン押下で打刻ページ(勤務開始)に遷移します。    
「休憩開始」ボタン押下で打刻ページ(休憩終了)に遷移します。  
![打刻ページ(勤務終了・休憩開始)](https://github.com/palhina/Atte/assets/129643430/15c8645f-008d-4b1a-af80-0fe78ac21073)
### 打刻ページ(休憩終了)  
最後に押したボタンが「休憩開始」だった場合、ログイン成功直後やナビゲーションメニュー「ホーム」押下で表示されるページです。  
打刻ボタンは「休憩終了」のみ押すことが可能です。  
「休憩終了」ボタン押下で打刻ページ(勤務終了、休憩開始)に遷移します。  
![打刻ページ(休憩終了)](https://github.com/palhina/Atte/assets/129643430/359c0b62-8b06-4836-b705-ad93a4ec239c)  
### 日付一覧ページ  
ナビゲーションメニュー「日付一覧」押下で表示されます。  
ある特定の年月日に出勤したユーザー全員の勤怠情報が表示されます。  
年月日（デフォルトでは本日を表示）の両側にある「＜」「＞」ボタン押下で、それぞれ前日、翌日の勤怠情報に遷移します。  
5件ずつページネーションされます。  
![日付別勤怠ページ](https://github.com/palhina/Atte/assets/129643430/62ec2356-972b-4d9b-ab41-c67caacb10ee)　　
### ユーザー一覧ページ  
ナビゲーションメニュー「ユーザー一覧」押下で表示されます。  
登録されているユーザー一覧が表示されます。    
5件ずつページネーションされます。  
![ユーザー一覧](https://github.com/palhina/Atte/assets/129643430/a49917bf-0f80-4ce0-9e4e-0ab6c8b6f467)
### ユーザー別勤怠一覧ページ  
ナビゲーションメニュー「ユーザー別勤怠一覧」押下で表示されます。  
現在ログイン中のユーザーの勤怠一覧を表示します。  
5件ずつページネーションされます。  
![ユーザー別勤怠一覧](https://github.com/palhina/Atte/assets/129643430/8e2e45a0-369c-4c53-b0d1-909cbe94445e)

## 作成した目的  
ある企業の人事評価のため、勤怠管理を行う  

## アプリケーションURL  
GithubURL：https://github.com/palhina/Atte.git  
http://atte-aws-app.xyz (別途設定が必要です：追記部分に後述)  

## ほかのレポジトリ  
今回はなし  

## 機能一覧  
新規会員登録  
ログイン機能  
メールによる二段階認証  
打刻（出勤開始・終了、休憩開始・終了）  
日付毎の(ユーザー全員の)勤怠履歴表示  
ユーザー一覧表示  
ユーザー毎の勤怠履歴表示    

## 使用技術(実行環境)  
Docker version 24.0.5  
Laravel 8.83.27  
認証機能はFortify使用  
Nginx 1.21.1  
MySQL 8.0.32  
PHP 8.1.2  
Composer 2.2.6  
MailHog  

## テーブル設計  
![テーブル仕様書](https://github.com/palhina/Atte/assets/129643430/a50519bd-6862-478f-aed5-b1362fcc23e0) 
 
## ER図  
![ER図](https://github.com/palhina/Atte/assets/129643430/0b810ea9-2b7e-49b2-96b7-6a49dc3bfec7)


## 環境構築  

* インストール手順

１．プロジェクトを保存したいディレクトリに移動し、その後Githubからリポジトリをクローンします：

        $git clone https://github.com/palhina/Atte.git
        
その後リポジトリのディレクトリに移動します：

        $cd Atte

２．Dockerを使用し、アプリケーションを起動します：
	
         $docker-compose up -d --build

３．Laravelのパッケージをインストールするために、phpコンテナ内にログインします：
	
          $ docker-compose exec php bash

４．コンテナ内でComposerをインストールします：
	
         $composer install

５．”.env”ファイルを作成し、データベース名、ユーザ名、パスワードなどの必要な環境変数を設定します：
	
         $cp .env.example .env

その後“.env”ファイルを編集し、必要な設定を追加、編集します。

６．アプリケーションキーを作成します：

        $php artisan key:generate

７．データベースのマイグレーションを実行します：

        $php artisan migrate
	
８．必要に応じて、ダミーデータの作成を行ってください：

        $php artisan db:seed

  
* アプリケーションはデフォルトで http://localhost:8000 でアクセスできます。

* MySQLはデフォルトで http://localhost:8080 でアクセスできます。

* ２段階認証において、テストメールの確認にMailHogを使用しています。デフォルトで http://localhost:8025 でアクセスできます。

* エラーが発生する場合、$ sudo chmod -R 777 *コマンドにて権限変更を行ってみてください。  

## 追記  
**日付をまたいだ場合の挙動について**
* 24時時点で勤務中の場合  
  当日23:59:59に勤務終了し、翌日00:00:00に勤務開始したと記録されます。  
  （翌日に「休憩開始」または「勤務終了」ボタンを押した時点で動作） 
* 24時時点で休憩中の場合  
  当日23:59:59に休憩終了・勤務終了し、翌日00:00:00に勤務開始・休憩開始したと記録されます。  
  （翌日に「休憩終了」ボタンを押した時点で動作）

**ダミーデータについて**  
* ユーザーデータ(パスワードはいずれも「1234567890」)  
 テスト太郎(メールアドレス、以下同様：111@mail.com)、テスト次郎(222@mail.com)、テスト三郎(333@mail.com)、テスト四郎(444@mail.com)、テスト五郎(555@mail.com)、テスト六郎(666@mail.com)を作成しています。  
* 出退勤記録  
  それぞれのユーザーについて、2021年11月1日の出勤・休憩記録を作成しています。  
* 初回ログイン時は二段階認証が必要になります。  

**AWS接続,ブラウザ上での閲覧について**  
以下の設定により、ブラウザ上でアプリケーションを閲覧することが可能です(HTTP接続のみ)。  
1. IAMユーザーでログイン  
  ユーザー名：study（権限：administration）アカウントID：973518952750、パスワード：dYfX58MBでログインしてください  
2. EC2インスタンス(atte-aws-app)とRDSインスタンス(atte-aws-app-db)を開始してください  
3. それぞれが正常に起動したことを確認し、EC2インスタンスのパブリックIPv4アドレス、あるいはパブリックIPv4DNSをブラウザに入力してください。  
4. URL (http://atte-aws-app.xyz) からアクセスする場合は、ElasticIPアドレスを発行しEC2インスタンスに紐づけた後、Route53のレコード名：atte-aws-app.xyzレコードタイプ：Aの値をElasticIPの値に変更してください。


**開発環境と本番環境について**
* 上記、EC2インスタンス(atte-aws-app)とRDSインスタンス(atte-aws-app-db)は開発環境を想定し大阪リージョンに作成しております。  
* 本番環境を想定したものは、開発環境と異なるVPC(atte-launch-vpc)およびリージョン(東京)で作成しております。EC2インスタンス名：atte-launch、RDSインスタンス名：atte-launch-dbとして作成しました。  
# Rese
